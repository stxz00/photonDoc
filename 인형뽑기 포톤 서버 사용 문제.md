# 1차 포톤 이슈 정리

# 포톤 개발 문제점
1. Photon Server에서는 방 생성과 삭제 모두 불가능. 클라이언트에서 가능.

2. Photon 클라이언트에서 방 생성은 모두가 생성이 가능하며 이를 막기 위해선 
  포톤에서 제공하는 커스텀 인증(클라이언트에서 id, token을 받는 ui가 필요)이나
  파이어베이스 파이어스토어(DB)에서 따로 저장된 운영자 데이터와 일치하는지 비교하거나 
  구글 로그인 인증(기존 익명 로그인에서 구글 로그인 추가) 후 방생성이 가능하도록 해야한다.

3. 방 삭제의 경우에는 삭제할 방의 마스터 클라이언트(방장)이어야 하고, 방에 접속하고 있어야하며, 
   마스터 클라이언트 권한으로 방에 접속한 플레이어들을 모두 내보낸 후
   방을 나가야 방이 삭제가 된다.
   * 마스터 클라이언트는 먼저 방을 생성한 자가 자동으로 권한을 받으며, 마스터 클라이언트가 나가면 다음에 접속하였던 플레이어에게 넘겨준다.

# 임시 해결 방안
클라이언트에서 게스트 로그인 후 Home Secene에서 파이어스토어에 gmData 컬렉션에 있는 
운영자 게스트 아이디(uid)와 일치하는지 검증.
일치하였다면 매 포톤 서버 접속 시 새로 발급받는 포톤 uid를 해당 데이터에 update

1. 방 생성 : 검증 후 운영자인 경우 방만들기 팝업 버튼 아이콘 활성화.

2. 방 삭제 : 방 삭제의 경우 운영자가 방을 만들고 나가지 않았다면 마스터 클라이언트 권한으로 
모든 플레이어들을 내보낸 후 삭제가 가능. (기존 운영자 인증 + 마스터 클라이언트 권한 존재)
운영자가 플레이어들이 존재한 상태로 방을 나간 후 다시 접속했을때 마스터 클라이언트 권한을 넘겨 받으려면
현재 마스터 클라이언트가 해당 플에 접속한 운영자한테 권한을 넘겨받아야 한다.
=> 마스터 클라이언트가 방에 접속자가 운영자인지 알 수 있는 방법은 새로운 플레이어가 방에 접속할 때마다
서로 공유받을 수 있는 Photon uid를 파이어베이스 DB에 검증하여 마스터 클라이언트 권한을 운영자에게 위임한다.
 * 마스터 클라이언트 권한 위임은 마스터 클라이언트만이 가능.

# 임시 해결 방안 도입 후 문제점

1. 익명 로그인의 uid 변경 문제 => 영구 아이디 로그인으로 전환할 필요가 있음.(Google, Email) 

# 변경 방안

1. photon 커스텀 인증 기능을 사용하여 id 값을 게스트 로그인 uid에 부여하고 액세스 토큰을 db에 저장 후 검증 작업 진행
